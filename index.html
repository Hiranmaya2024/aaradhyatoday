<!DOCTYPE html>
<html lang="en">
<head>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Daily Tour â€“ AAradhya</title>
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet">

<style>
body{font-family:Poppins;margin:0;background:#f4f6f9}
.header{background:#0d6efd;color:#fff;padding:14px;font-weight:600}
.card{background:#fff;margin:10px;padding:14px;border-radius:12px;box-shadow:0 2px 8px rgba(0,0,0,0.08)}
button{padding:10px;border:none;border-radius:8px;font-weight:600}
.visit{background:#28a745;color:#fff;margin-top:8px;width:100%}
.tour{background:#ff9800;color:#fff;margin:10px;width:94%}
.summary{display:grid;grid-template-columns:1fr 1fr;gap:8px;margin:10px}
</style>
</head>

<body>

<div class="header">ðŸ“… Todayâ€™s Tour Plan</div>

<div class="summary">
<div class="card" id="totalParties"></div>
<div class="card" id="pendingParties"></div>
<div class="card" id="visitedParties"></div>
<div class="card" id="target"></div>
</div>

<button class="tour" onclick="startTour()">ðŸ§­ Start Smart Tour</button>

<div id="list"></div>

<script>

const csvUrl="YOUR CSV URL"

let allCustomers=[]
let todayParties=[]
let visited=JSON.parse(localStorage.getItem("visited")||"[]")
let userLat="",userLng=""

navigator.geolocation.getCurrentPosition(pos=>{
userLat=pos.coords.latitude
userLng=pos.coords.longitude
})

const tourPlan={
Monday:["Juria"],
Tuesday:["Ghess"],
Wednesday:["Gaisilate"],
Thursday:["Dava"],
Friday:["Padampur"],
Saturday:["Paikmal","Mandosil"]
}

const today=new Date().toLocaleDateString('en-US',{weekday:'long'})
const todayAreas=tourPlan[today]||[]

fetch(csvUrl)
.then(res=>res.text())
.then(text=>{

let rows=text.split("\n").slice(1)

allCustomers=rows.map(r=>{
let c=r.split(",")
return{
name:c[0],
area:c[1],
due:parseFloat(c[6])||0,
lat:c[14],
lng:c[15]
}
})

todayParties=allCustomers.filter(c=>todayAreas.includes(c.area))

render()

})

function render(){

let pending=todayParties.filter(p=>!visited.includes(p.name))

list.innerHTML=""

pending.forEach(p=>{

list.innerHTML+=`
<div class="card">
<b>${p.name}</b><br>
Due â‚¹${p.due}
<button class="visit" onclick="markVisited('${p.name}')">âœ” Visit Done</button>
</div>`
})

updateSummary()
}

function markVisited(name){
visited.push(name)
localStorage.setItem("visited",JSON.stringify(visited))
render()
navigateNext()
}

function updateSummary(){

totalParties.innerHTML="Total Parties<br><b>"+todayParties.length+"</b>"

visitedParties.innerHTML="Visited<br><b>"+visited.length+"</b>"

pendingParties.innerHTML="Pending<br><b>"+(todayParties.length-visited.length)+"</b>"

let totalDue=todayParties.reduce((s,p)=>s+p.due,0)
target.innerHTML="Target<br><b>â‚¹"+Math.round(totalDue*0.3)+"</b>"
}

function startTour(){

let route=todayParties
.filter(p=>p.lat)
.map(p=>`${p.lat},${p.lng}`)
.join("/")

window.open(`https://www.google.com/maps/dir/${userLat},${userLng}/${route}`)
}

function navigateNext(){

let next=todayParties.find(p=>!visited.includes(p.name))

if(next){
window.open(`https://www.google.com/maps?q=${next.lat},${next.lng}`)
}
}

</script>

</body>
</html>