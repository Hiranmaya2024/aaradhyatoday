<!DOCTYPE html>
<html>
<head>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>AARADHYA TODAY</title>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>

<style>
body{font-family:Arial;margin:0;background:#f3fbf9;}
.header{background:linear-gradient(90deg,#1e8e7e,#2fa36b);color:white;text-align:center;padding:14px;}
.container{padding:12px;}
.card{background:white;padding:14px;margin-bottom:12px;border-radius:12px;box-shadow:0 2px 6px rgba(0,0,0,0.1);}
.big{font-size:20px;font-weight:bold;color:#1e8e7e;}
ul{padding-left:18px;margin:0;}
</style>
</head>

<body>

<div class="header">
<b>AARADHYA TODAY</b><br>
<span id="tourArea"></span>
</div>

<div class="container">

<div class="card"><b>ðŸŽ¯ Todayâ€™s Collection Target</b>
<div id="dailyTarget" class="big"></div></div>

<div class="card"><b>ðŸš¨ Top 10 High Risk Parties</b>
<ul id="riskParties"></ul></div>

<div class="card"><b>ðŸ“Œ Top 10 Credit Cycle Exceeded</b>
<ul id="creditExceeded"></ul></div>

</div>

<script>

const sheetURL = "https://docs.google.com/spreadsheets/d/e/2PACX-1vQ3bMMFf71-vdGNiWFnf7pD9XuAAUSA7J-g08ocyC2LNiVOTUHi56lB-7bKTKj0KK9nJGs9vU0THQ0E/pub?gid=1044390124&single=true&output=csv";

// TOUR PLAN
const tourPlan = {
Monday:["Juria"],
Tuesday:["Ghess"],
Wednesday:["Gaisilate"],
Thursday:["Jharbandh"],
Friday:["Padampur"],
Saturday:["Paikmal","Mandosil"]
};

function cleanNumber(val){
return Number(String(val || 0).replace(/[^0-9.-]/g,"")) || 0;
}

function normalize(text){
return text.toLowerCase().replace(/[^a-z]/g,"");
}

function loadData(){

const today = new Date().toLocaleDateString("en-US",{weekday:"long"});
const todayAreas = tourPlan[today] || [];

document.getElementById("tourArea").innerText =
today + " Tour â†’ " + todayAreas.join(", ");

Papa.parse(sheetURL,{
download:true,
header:true,
skipEmptyLines:true,

complete:function(res){

const data = res.data;
const columns = Object.keys(data[0]);
const col = name => columns.find(c => normalize(c).includes(name));

const AREA = col("area");
const PARTY = col("party");
const BALANCE = col("balance");
const RISK = col("balanceasofbusiness");
const CREDIT = col("avgcreditcycle");

let areaBalance = 0;

let riskArr=[],creditArr=[];

data.forEach(row=>{

let partyArea = row[AREA];

if(!todayAreas.includes(partyArea)) return;

let balance = cleanNumber(row[BALANCE]);
let risk = cleanNumber(row[RISK]);
let credit = cleanNumber(row[CREDIT]);

areaBalance += balance;

if(risk>0) riskArr.push({party:row[PARTY],balance,risk});
if(credit>45) creditArr.push({party:row[PARTY],credit});

});

// TARGET â†’ 30% OF AREA BALANCE
let target = areaBalance * 0.30;
document.getElementById("dailyTarget").innerText =
"â‚¹" + Math.round(target).toLocaleString();

// SORT & TOP 10
riskArr.sort((a,b)=>b.risk-a.risk);
creditArr.sort((a,b)=>b.credit-a.credit);

document.getElementById("riskParties").innerHTML =
riskArr.slice(0,10).map(r=>`<li>${r.party} â€“ â‚¹${r.balance.toLocaleString()} â€“ ${r.risk}%</li>`).join("");

document.getElementById("creditExceeded").innerHTML =
creditArr.slice(0,10).map(c=>`<li>${c.party} â€“ ${c.credit} days</li>`).join("");

}

});

}

loadData();
setInterval(loadData,300000);

</script>

</body>
</html>