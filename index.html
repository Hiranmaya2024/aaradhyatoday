<!DOCTYPE html>
<html>
<head>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>AARADHYA TODAY</title>
<script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>

<style>
body{font-family:Arial;margin:0;background:#f1f5f9}
.header{position:sticky;top:0;background:#fff;padding:10px;border-bottom:1px solid #ddd;text-align:center}
.card{background:#fff;margin:8px;padding:10px;border-radius:12px;border:1px solid #e2e8f0}
.party{padding:10px;border-bottom:1px solid #eee;display:flex;justify-content:space-between;cursor:pointer}
.active{border-left:5px solid #22c55e}
.block{border-left:5px solid #ef4444;background:#fff1f2}
.progressBox{height:6px;background:#e5e7eb;border-radius:10px;margin-top:6px}
.progressBar{height:6px;border-radius:10px}
</style>
</head>

<body>

<div class="header">
<div id="day"></div>
<div id="kpi"></div>
<div class="progressBox"><div id="progressBar" class="progressBar"></div></div>
</div>

<div class="card" id="mission"></div>
<div class="card" id="routeSummary"></div>
<div class="card" id="quickStats"></div>

<div class="card">
<b>Today Route</b>
<div id="count"></div>
<div id="partyList"></div>
</div>

<div class="card" id="creditList"></div>

<script>

const tourPlan={
Monday:["JURIA"],
Tuesday:["GHESS"],
Wednesday:["GAISILATE"],
Thursday:["JHARBANDH"],
Friday:["PADAMPUR"],
Saturday:["PAIKMAL","MANDOSIL"]
};

const today=new Date().toLocaleDateString("en-US",{weekday:"long"});
document.getElementById("day").innerText=today+" → "+tourPlan[today].join(", ");

function num(v){return Number(String(v||0).replace(/[^0-9.-]/g,""))||0;}

const url="https://docs.google.com/spreadsheets/d/e/2PACX-1vQ3bMMFf71-vdGNiWFnf7pD9XuAAUSA7J-g08ocyC2LNiVOTUHi56lB-7bKTKj0KK9nJGs9vU0THQ0E/pub?gid=1044390124&single=true&output=csv";

Papa.parse(url,{download:true,header:true,skipEmptyLines:true,complete:function(res){

let data=res.data;

let fyBusiness=0,fyBalance=0;

let todayData=data.filter(r=>
tourPlan[today].includes((r["AREA"]||"").toUpperCase())
);

let block=0,active=0,unlock=0,reactivate=0;
let todayBusiness=0,todayCollection=0;
let creditList=[];

todayData.forEach(r=>{

fyBusiness+=num(r["BUSINESS"]);
fyBalance+=num(r["BALANCE"]);

todayBusiness+=num(r["BUSINESS CURRENT MONTH"]);
todayCollection+=num(r["Collections Current Month"]);

if((r["ACCOUNT STATUS"]||"").toUpperCase()=="BLOCK"){
block++;
unlock+=num(r["BALANCE"]);
reactivate+=num(r["Payment needed to Reactivate"]);
}else active++;

if(num(r["AVG CREDIT CYCLE"])>45){
creditList.push(r["PARTY"]);
}

});

let fyCollection=fyBusiness-fyBalance;
let percent=(fyCollection/fyBusiness)*100;

document.getElementById("kpi").innerHTML=
"FY Business ₹"+fyBusiness.toLocaleString()+" | Collection ₹"+fyCollection.toLocaleString();

let bar=document.getElementById("progressBar");
bar.style.width=percent+"%";
bar.style.background=percent<40?"red":percent<70?"orange":"green";

let target=Math.round(fyBalance*0.3);

document.getElementById("mission").innerHTML=
"Today Target ₹"+target.toLocaleString()+"<br>Today Collection ₹"+todayCollection.toLocaleString();

document.getElementById("routeSummary").innerHTML=
"Blocked "+block+" | Active "+active+"<br>Unlock ₹"+unlock.toLocaleString()+" | Target ₹"+reactivate.toLocaleString();

document.getElementById("quickStats").innerHTML=
"Today Business ₹"+todayBusiness.toLocaleString()+" | Today Collection ₹"+todayCollection.toLocaleString();

document.getElementById("count").innerText=todayData.length+" Parties";

document.getElementById("partyList").innerHTML=
todayData.map(p=>`
<div class="party ${(p["ACCOUNT STATUS"]||"").toUpperCase()=="BLOCK"?"block":"active"}">
${p["PARTY"]}
<span>₹${num(p["BALANCE"]).toLocaleString()}</span>
</div>
`).join("");

document.getElementById("creditList").innerHTML=
"<b>Credit Cycle > 45</b><br>"+creditList.join("<br>");

}});
</script>

</body>
</html>