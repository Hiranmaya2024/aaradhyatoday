<!DOCTYPE html>
<html>
<head>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>AARADHYA TODAY</title>

<script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>

<style>
*{box-sizing:border-box}
body{font-family:Arial;margin:0;background:#f3fbf9;}

.header{
position:sticky;top:0;z-index:1000;
background:linear-gradient(90deg,#1e8e7e,#2fa36b);
color:white;text-align:center;padding:12px;
}

.progressBox{background:#ffffff40;border-radius:10px;height:8px;margin:6px auto;max-width:500px;}
#progressBar{height:8px;border-radius:10px;}

button.refresh{margin-top:6px;padding:6px 12px;border:none;border-radius:6px;font-weight:bold;}

.container{padding:12px;max-width:1400px;margin:auto;}
.dashboard-grid{display:grid;gap:12px;grid-template-columns:repeat(auto-fit,minmax(280px,1fr));}

.card{background:white;padding:14px;border-radius:14px;box-shadow:0 2px 8px rgba(0,0,0,0.08);}
.big{font-size:15px;font-weight:bold;color:#1e8e7e;line-height:1.6;}

ul{padding-left:18px;margin:0;max-height:260px;overflow:auto;}
li{cursor:pointer;margin-bottom:6px;}

.blockCard{border:2px solid #dc2626;background:#fff1f2;}
.unlockBox{background:#16a34a;color:white;padding:8px;border-radius:8px;margin:8px 0;text-align:center;font-weight:bold;}
.payBox{background:#dc2626;color:white;padding:10px;border-radius:10px;margin:10px 0;text-align:center;font-weight:bold;}

.summaryGrid{display:grid;grid-template-columns:repeat(2,1fr);gap:8px;margin-top:8px;}
.summaryBox{background:#fff1f2;padding:8px;border-radius:8px;font-weight:bold;}

.recoveryItem{
background:#ecfdf5;border-left:5px solid #16a34a;
padding:8px;border-radius:8px;margin-bottom:8px;font-weight:bold;
}
</style>
</head>

<body>

<div class="header">
<b>AARADHYA TODAY</b>
<div id="tourArea"></div>

<div id="totalBusiness"></div>
<div id="totalCollection"></div>

<div class="progressBox"><div id="progressBar"></div></div>
<div id="businessStatus"></div>

<button class="refresh" onclick="loadData()">üîÑ Refresh</button>
<div id="lastUpdated" style="font-size:12px;"></div>
</div>

<div class="container">
<div class="dashboard-grid">

<div class="card" id="partyCard" style="display:none;">
<b>üë§ Party Details</b>
<div id="partyDetails" class="big"></div>
</div>

<div class="card">
<b>üö´ Route Reactivation Summary</b>
<div id="reactivationSummary" class="big"></div>
</div>

<div class="card">
<b>üß† Smart Recovery Plan ‚Äì Today</b>
<div id="smartRecovery"></div>
</div>

<div class="card">
<b>üìä Quick Stats ‚Äì All Areas (MTD)</b>
<div id="quickStats" class="big"></div>
</div>

<div class="card">
<b>üìç Today‚Äôs Tour Performance (MTD)</b>
<div id="tourStats" class="big"></div>
</div>

<div class="card">
<b>üéØ Today‚Äôs Collection Target</b>
<div id="dailyTarget" class="big"></div>
</div>

<div class="card">
<b>üß≠ Today‚Äôs Route Parties</b>
<div id="todayCount" class="big"></div>
<ul id="todayParties"></ul>
</div>

<div class="card">
<b>‚è± Credit Cycle > 45 Days</b>
<div id="creditCount"></div>
<ul id="creditExceeded"></ul>
</div>

</div>
</div>

<script>

const sheetURL="https://docs.google.com/spreadsheets/d/e/2PACX-1vQ3bMMFf71-vdGNiWFnf7pD9XuAAUSA7J-g08ocyC2LNiVOTUHi56lB-7bKTKj0KK9nJGs9vU0THQ0E/pub?gid=1044390124&single=true&output=csv";

const tourPlan={
Monday:["JURIA"],
Tuesday:["GHESS"],
Wednesday:["GAISILATE"],
Thursday:["JHARBANDH"],
Friday:["PADAMPUR"],
Saturday:["PAIKMAL","MANDOSIL"]
};

function num(v){return Number(String(v||0).replace(/[^0-9.-]/g,""))||0;}

function loadData(){

const today=new Date().toLocaleDateString("en-US",{weekday:"long"});
const todayAreas=tourPlan[today]||[];

document.getElementById("tourArea").innerText=today+" Tour ‚Üí "+todayAreas.join(", ");

Papa.parse(sheetURL+"&t="+Date.now(),{
download:true,header:true,skipEmptyLines:true,

complete:function(res){

let data=res.data;

let fyBusiness=0,fyBalance=0,mtdBusiness=0,mtdCollection=0;
let tourBalance=0,tourBusiness=0,tourCollection=0;

let blockCount=0,totalReactivate=0,totalRecovered=0,unlockBusiness=0;

let todayList=[],creditList=[],smartList=[];

data.forEach(r=>{

let area=(r["AREA"]||"").trim().toUpperCase();
let status=(r["ACCOUNT STATUS"]||"").trim().toUpperCase();

let business=num(r["BUSINESS"]);
let balance=num(r["BALANCE"]);
let mtdBus=num(r["BUSINESS CURRENT MONTH"]);
let mtdCol=num(r["Collections Current Month"]);
let credit=num(r["AVG CREDIT CYCLE"]);
let reactivate=num(r["Payment needed to Reactivate"]);

fyBusiness+=business;
fyBalance+=balance;
mtdBusiness+=mtdBus;
mtdCollection+=mtdCol;

if(todayAreas.includes(area)){

tourBalance+=balance;
tourBusiness+=mtdBus;
tourCollection+=mtdCol;

todayList.push({name:r["PARTY"],balance});

if(credit>45){
creditList.push({name:r["PARTY"],credit});
}

if(status==="BLOCK"){

blockCount++;
totalReactivate+=reactivate;
totalRecovered+=mtdCol;
unlockBusiness+=business;

let remaining=reactivate-mtdCol;
if(remaining<0)remaining=0;

smartList.push({name:r["PARTY"],remaining,unlock:business});
}

}

});

// HEADER
let fyCollection=fyBusiness-fyBalance;
let percent=(fyCollection/fyBusiness)*100;

document.getElementById("totalBusiness").innerHTML=`üíº Business: ‚Çπ${Math.round(fyBusiness).toLocaleString()}`;
document.getElementById("totalCollection").innerHTML=`üí∞ Collection: ‚Çπ${Math.round(fyCollection).toLocaleString()}`;

let bar=document.getElementById("progressBar");
bar.style.width=percent+"%";
bar.style.background=percent<40?"red":percent<70?"orange":"limegreen";

document.getElementById("businessStatus").innerHTML=`Status: ${percent.toFixed(0)}%`;

// QUICK STATS
document.getElementById("quickStats").innerHTML=
`MTD Business: ‚Çπ${Math.round(mtdBusiness).toLocaleString()}<br>
MTD Collection: ‚Çπ${Math.round(mtdCollection).toLocaleString()}`;

// TOUR
document.getElementById("tourStats").innerHTML=
`MTD Business: ‚Çπ${Math.round(tourBusiness).toLocaleString()}<br>
MTD Collection: ‚Çπ${Math.round(tourCollection).toLocaleString()}`;

let target=tourBalance*0.30;
document.getElementById("dailyTarget").innerText="‚Çπ"+Math.round(target).toLocaleString();

// REACTIVATION SUMMARY
let remainingReactivate=totalReactivate-totalRecovered;
if(remainingReactivate<0)remainingReactivate=0;

document.getElementById("reactivationSummary").innerHTML=
`Blocked: ${blockCount}<br>
Unlock Business: ‚Çπ${Math.round(unlockBusiness).toLocaleString()}<br>
Target: ‚Çπ${Math.round(totalReactivate).toLocaleString()}<br>
Recovered: ‚Çπ${Math.round(totalRecovered).toLocaleString()}<br>
Remaining: ‚Çπ${Math.round(remainingReactivate).toLocaleString()}`;

// SMART RECOVERY
smartList.sort((a,b)=>a.remaining-b.remaining);
let topRecovery=smartList.slice(0,5);

let totalNeed=0,totalUnlock=0;
topRecovery.forEach(p=>{
totalNeed+=p.remaining;
totalUnlock+=p.unlock;
});

document.getElementById("smartRecovery").innerHTML=
`Collect ‚Çπ${Math.round(totalNeed).toLocaleString()} ‚Üí Unlock ‚Çπ${Math.round(totalUnlock).toLocaleString()}
${topRecovery.map(p=>`<div class="recoveryItem">${p.name}<br>üí∞ ‚Çπ${p.remaining.toLocaleString()} ‚Üí üîì ‚Çπ${p.unlock.toLocaleString()}</div>`).join("")}`;

document.getElementById("todayCount").innerHTML=`Total Parties: ${todayList.length}`;

document.getElementById("todayParties").innerHTML=
todayList.map(p=>`<li>${p.name} ‚Äì ‚Çπ${p.balance.toLocaleString()}</li>`).join("");

document.getElementById("creditCount").innerHTML=`Total Parties: ${creditList.length}`;

document.getElementById("creditExceeded").innerHTML=
creditList.map(c=>`<li>${c.name} ‚Äì ${c.credit} days</li>`).join("");

document.getElementById("lastUpdated").innerText="Last updated: "+new Date().toLocaleTimeString();

}

});

}

loadData();
setInterval(loadData,120000);

</script>

</body>
</html>
