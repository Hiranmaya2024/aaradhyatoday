<!DOCTYPE html>
<html lang="en">
<head>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>AAradhya Customers</title>

<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet">

<style>

body{font-family:Poppins;margin:0;background:#f4f6f9;color:#333}

/* Launch */
#launch{
height:100vh;
display:flex;
justify-content:center;
align-items:center;
text-align:center;
background:linear-gradient(135deg,#0f2027,#2c5364);
color:#fff
}

/* Header */
.header{
background:#0d6efd;
color:#fff;
padding:15px;
font-weight:600;
position:sticky;
top:0;
z-index:10
}

.searchBox{padding:10px;background:#fff;position:sticky;top:56px}

input{
width:100%;
padding:12px;
border-radius:10px;
border:1px solid #ddd;
font-size:16px
}

.tourBtn{
margin-top:10px;
width:100%;
padding:12px;
border:none;
border-radius:10px;
background:#ff9800;
color:#fff;
font-weight:600
}

.list{padding:10px;display:grid;gap:10px}

.customer{
background:#fff;
padding:14px;
border-radius:12px;
box-shadow:0 2px 6px rgba(0,0,0,0.08);
font-weight:600
}

.card{
background:#fff;
margin:12px;
padding:18px;
border-radius:14px;
box-shadow:0 4px 12px rgba(0,0,0,0.1)
}

.row{display:flex;justify-content:space-between;margin:6px 0}

.actions{
position:fixed;
bottom:0;
width:100%;
background:#fff;
display:flex;
gap:10px;
padding:10px;
box-shadow:0 -2px 8px rgba(0,0,0,0.1)
}

button{
flex:1;
padding:14px;
border:none;
border-radius:10px;
font-size:15px;
color:#fff;
font-weight:600
}

.call{background:#28a745}
.wa{background:#25D366}
.nav{background:#0d6efd}

@media(min-width:700px){
.list{grid-template-columns:1fr 1fr}
}

@media(min-width:1024px){
.list{grid-template-columns:1fr 1fr 1fr}
}

</style>
</head>

<body>

<!-- Launch -->
<div id="launch" onclick="startApp()">
<div>
<h2>Welcome to</h2>
<h1>AAradhya Pharmaceuticals</h1>
<p>Tap to continue</p>
</div>
</div>

<!-- List -->
<div id="listScreen" style="display:none">
<div class="header">Customers</div>

<div class="searchBox">
<input type="text" placeholder="Search customer..." onkeyup="searchCustomer(this.value)">
<button class="tourBtn" onclick="startTour()">üß≠ Start Today‚Äôs Tour</button>
</div>

<div class="list" id="customerList"></div>
</div>

<!-- Profile -->
<div id="profileScreen" style="display:none">
<div class="header" onclick="goBack()">‚¨Ö Customer Profile</div>
<div id="profileCard"></div>

<div class="actions">
<button class="call" onclick="call()">Call</button>
<button class="wa" onclick="whatsapp()">WhatsApp</button>
<button class="nav" onclick="navigate()">Navigate</button>
</div>
</div>

<script>

const csvUrl = "https://docs.google.com/spreadsheets/d/e/2PACX-1vQ3bMMFf71-vdGNiWFnf7pD9XuAAUSA7J-g08ocyC2LNiVOTUHi56lB-7bKTKj0KK9nJGs9vU0THQ0E/pub?gid=1044390124&single=true&output=csv"

let customers=[]
let selected={}
let userLat="",userLng=""

/* Get GPS */
navigator.geolocation.getCurrentPosition(pos=>{
userLat=pos.coords.latitude
userLng=pos.coords.longitude
})

function startApp(){
launch.style.display="none"
listScreen.style.display="block"
}

/* CSV parser */
function parseCSV(text){
const rows=[]
let row=[],value="",insideQuotes=false

for(let char of text){

if(char=='"'){insideQuotes=!insideQuotes;continue}

if(char=="," && !insideQuotes){row.push(value);value="";continue}

if((char=="\n"||char=="\r") && !insideQuotes){
if(value||row.length){row.push(value);rows.push(row)}
row=[];value=""
continue
}

value+=char
}
return rows
}

fetch(csvUrl)
.then(res=>res.text())
.then(text=>{

let rows=parseCSV(text).slice(1)
rows=rows.filter(r=>r[0])

customers=rows.map(c=>({

name:c[0],
area:c[1],
status:c[2],
reason:c[3],
reactivate:c[4],
business:parseFloat(c[5])||0,
due:parseFloat(c[6])||0,
phone:c[13],
lat:c[14],
lng:c[15],
lastSale:c[17],
lastCollection:c[18]

}))

customers.sort((a,b)=>b.due-a.due)

renderList(customers)

})

function getDistance(lat,lng){

if(!userLat||!lat) return ""

const R=6371
const dLat=(lat-userLat)*Math.PI/180
const dLng=(lng-userLng)*Math.PI/180

const a=
Math.sin(dLat/2)**2+
Math.cos(userLat*Math.PI/180)*
Math.cos(lat*Math.PI/180)*
Math.sin(dLng/2)**2

return (R*2*Math.atan2(Math.sqrt(a),Math.sqrt(1-a))).toFixed(1)+" km"
}

function renderList(data){

customerList.innerHTML=""

data.forEach((c,i)=>{

let bg="#fff"

if(c.status.toLowerCase().includes("blocked")) bg="#ffebee"
else if(c.due>0) bg="#fff3cd"

customerList.innerHTML+=`
<div class="customer" style="background:${bg}" onclick="openProfile(${i})">
${c.name}
<br>
<small>Due: ‚Çπ${c.due} | üìç ${getDistance(c.lat,c.lng)}</small>
</div>`
})
}

function searchCustomer(val){
let filtered=customers.filter(c=>c.name.toLowerCase().includes(val.toLowerCase()))
renderList(filtered)
}

function openProfile(i){

selected=customers[i]

listScreen.style.display="none"
profileScreen.style.display="block"

profileCard.innerHTML=`

<div class="card">

<h3>${selected.name}</h3>

<div class="row"><div>Phone</div><div>${selected.phone}</div></div>
<div class="row"><div>Area</div><div>${selected.area}</div></div>
<div class="row"><div>Total Business</div><div>‚Çπ${selected.business}</div></div>
<div class="row"><div>Total Due</div><div>‚Çπ${selected.due}</div></div>
<div class="row"><div>Last Sale</div><div>${selected.lastSale}</div></div>
<div class="row"><div>Last Collection</div><div>${selected.lastCollection}</div></div>
<div class="row"><div>Status</div><div>${selected.status}</div></div>
<div class="row"><div>Reason</div><div>${selected.reason}</div></div>
<div class="row"><div>Reactivate by Paying</div><div>‚Çπ${selected.reactivate}</div></div>

</div>
`
}

function goBack(){
profileScreen.style.display="none"
listScreen.style.display="block"
}

function call(){
window.location.href="tel:"+selected.phone
}

function whatsapp(){

let msg=`Dear ${selected.name},

Your outstanding balance is ‚Çπ${selected.due}.

Kindly make the payment to continue smooth supply.

AAradhya Pharmaceuticals`

window.open(`https://wa.me/91${selected.phone}?text=${encodeURIComponent(msg)}`)
}

function navigate(){
window.open(`https://www.google.com/maps?q=${selected.lat},${selected.lng}`)
}

function startTour(){

let route=customers
.filter(c=>c.lat&&c.lng)
.map(c=>`${c.lat},${c.lng}`)
.join("/")

window.open(`https://www.google.com/maps/dir/${userLat},${userLng}/${route}`)
}

</script>

</body>
</html>