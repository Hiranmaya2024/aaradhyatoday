<!DOCTYPE html>
<html>
<head>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>AAradhya Route</title>
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet">

<style>
body{font-family:Poppins;margin:0;background:#f4f6f9}
.header{background:#0d6efd;color:#fff;padding:15px;font-weight:600}

.routeBox{
background:#fff;margin:10px;padding:14px;border-radius:12px;
box-shadow:0 2px 8px rgba(0,0,0,0.08)
}

.customer{background:#fff;margin:10px;padding:14px;border-radius:12px}
</style>
</head>

<body>

<div class="header">AAradhya Tour</div>

<div id="routeBox" class="routeBox">Loading route‚Ä¶</div>

<div id="customerList"></div>

<script>

const GOOGLE_API_KEY="PASTE_YOUR_KEY_HERE"

const csvUrl="https://docs.google.com/spreadsheets/d/e/2PACX-1vQ3bMMFf71-vdGNiWFnf7pD9XuAAUSA7J-g08ocyC2LNiVOTUHi56lB-7bKTKj0KK9nJGs9vU0THQ0E/pub?gid=1044390124&single=true&output=csv"

const tourPlan={
Monday:["Juria"],
Tuesday:["Ghess"],
Wednesday:["Gaisilate"],
Thursday:["Dava"],
Friday:["Padampur"],
Saturday:["Paikmal","Mandosil"]
}

let userLat,userLng
let todayRoute=[]

navigator.geolocation.getCurrentPosition(pos=>{
userLat=pos.coords.latitude
userLng=pos.coords.longitude
loadData()
})

function parseCSV(text){
const rows=[]
let row=[],value="",insideQuotes=false
for(let char of text){
if(char=='"'){insideQuotes=!insideQuotes;continue}
if(char==","&&!insideQuotes){row.push(value);value="";continue}
if((char=="\n"||char=="\r")&&!insideQuotes){
if(value||row.length){row.push(value);rows.push(row)}
row=[];value=""
continue}
value+=char}
return rows
}

function loadData(){

fetch(csvUrl)
.then(res=>res.text())
.then(text=>{

let rows=parseCSV(text).slice(1).filter(r=>r[0])

let customers=rows.map(r=>({
name:r[0],
area:r[1],
lat:parseFloat(r[14]),
lng:parseFloat(r[15])
}))

const today=new Date().toLocaleDateString('en-US',{weekday:'long'})
const todayAreas=tourPlan[today]||[]

todayRoute=customers.filter(c=>todayAreas.includes(c.area) && c.lat)

drawRouteSummary()

})
}

function drawRouteSummary(){

let waypoints=todayRoute.map(p=>`${p.lat},${p.lng}`).join("|")

let url=`https://maps.googleapis.com/maps/api/directions/json?origin=${userLat},${userLng}&destination=${todayRoute[todayRoute.length-1].lat},${todayRoute[todayRoute.length-1].lng}&waypoints=${waypoints}&key=${GOOGLE_API_KEY}`

fetch(url)
.then(res=>res.json())
.then(data=>{

let totalDistance=0
let totalTime=0

data.routes[0].legs.forEach(leg=>{
totalDistance+=leg.distance.value
totalTime+=leg.duration.value
})

routeBox.innerHTML=`
<h3>üóì Today‚Äôs Route</h3>
Parties: ${todayRoute.length}<br>
üìè ${(totalDistance/1000).toFixed(1)} km<br>
‚è± ${(totalTime/3600).toFixed(1)} hrs<br><br>
<button onclick="startTour()">Start Navigation</button>
`

})
}

function startTour(){

let route=todayRoute.map(p=>`${p.lat},${p.lng}`).join("/")
window.open(`https://www.google.com/maps/dir/${userLat},${userLng}/${route}`)
}

</script>
</body>
</html>