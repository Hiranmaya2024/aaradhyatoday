<!DOCTYPE html>
<html>
<head>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>AARADHYA TODAY</title>

<link rel="manifest" href="manifest.json">

<script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>

<style>
body{font-family:Arial;margin:0;background:#f3fbf9;}
.header{background:linear-gradient(90deg,#1e8e7e,#2fa36b);color:white;text-align:center;padding:14px;}
.container{padding:12px;}
.card{background:white;padding:14px;margin-bottom:12px;border-radius:12px;box-shadow:0 2px 6px rgba(0,0,0,0.1);}
.big{font-size:17px;font-weight:bold;color:#1e8e7e;line-height:1.6;}
ul{padding-left:18px;margin:0;}
li{cursor:pointer;margin-bottom:6px;}
button{padding:10px;border:none;border-radius:8px;margin:5px 5px 0 0;font-weight:bold;}
.call{background:#2563eb;color:white;}
.whatsapp{background:#16a34a;color:white;}
.collect{background:#f59e0b;color:white;}
.bill{background:#7c3aed;color:white;}
</style>
</head>

<body>

<div class="header">
<b>AARADHYA TODAY</b><br>
<span id="tourArea"></span>
</div>

<div class="container">

<div class="card" id="partyCard" style="display:none;border:2px solid #1e8e7e;">
<b>üë§ Party Details</b>
<div id="partyDetails" class="big"></div>
<div id="actionButtons"></div>
</div>

<div class="card">
<b>üìä Quick Stats ‚Äì All Areas (MTD)</b>
<div id="quickStats" class="big"></div>
</div>

<div class="card">
<b>üìç Today‚Äôs Tour Performance (MTD)</b>
<div id="tourStats" class="big"></div>
</div>

<div class="card">
<b>üéØ Today‚Äôs Collection Target</b>
<div id="dailyTarget" class="big"></div>
</div>

<div class="card">
<b>üß≠ Today‚Äôs Route Parties</b>
<div id="todayCount" class="big"></div>
<ul id="todayParties"></ul>
</div>

<div class="card">
<b>‚è± Credit Cycle > 45 Days</b>
<div id="creditCount" class="big"></div>
<ul id="creditExceeded"></ul>
</div>

</div>

<script>

const sheetURL = "https://docs.google.com/spreadsheets/d/e/2PACX-1vQ3bMMFf71-vdGNiWFnf7pD9XuAAUSA7J-g08ocyC2LNiVOTUHi56lB-7bKTKj0KK9nJGs9vU0THQ0E/pub?gid=1044390124&single=true&output=csv";

const tourPlan = {
Monday:["Juria"],
Tuesday:["Ghess"],
Wednesday:["Gaisilate"],
Thursday:["Jharbandh"],
Friday:["Padampur"],
Saturday:["Paikmal","Mandosil"]
};

function cleanNumber(val){
return Number(String(val||0).replace(/[^0-9.-]/g,""))||0;
}

function normalize(text){
return text.toLowerCase().replace(/[^a-z]/g,"");
}

function loadData(){

const today = new Date().toLocaleDateString("en-US",{weekday:"long"});
const todayAreas = tourPlan[today]||[];

document.getElementById("tourArea").innerText =
today+" Tour ‚Üí "+todayAreas.join(", ");

Papa.parse(sheetURL,{
download:true,
header:true,
skipEmptyLines:true,

complete:function(res){

window.sheetData = res.data;
const data = sheetData;

const columns = Object.keys(data[0]);
const col = name => columns.find(c => normalize(c).includes(name));

const AREA = col("area");
const PARTY = col("party");
const STATUS = col("accountstatus");
const BALANCE = col("balance");
const BUSINESS_MTD = col("businesscurrentmonth");
const COLLECTION_MTD = col("collectionscurrentmonth");
const REACTIVATE = col("paymentneededtoreactivate");
const FY_BUSINESS = col("business");
const RISK = col("balanceasofbusiness");
const CREDIT = col("avgcreditcycle");

let totalShops = data.length, active=0,inactive=0;
let totalBusiness=0,totalCollection=0;

let tourShops=0,tourActive=0,tourInactive=0;
let tourBusiness=0,tourCollection=0;
let areaBalance=0;

let todayPartyArr=[];
let creditArr=[];

data.forEach(row=>{

let status=(row[STATUS]||"").toUpperCase();

if(status==="ACTIVE") active++; else inactive++;

let b=cleanNumber(row[BUSINESS_MTD]);
let c=cleanNumber(row[COLLECTION_MTD]);

totalBusiness+=b;
totalCollection+=c;

if(todayAreas.includes(row[AREA])){

tourShops++;

if(status==="ACTIVE") tourActive++; else tourInactive++;

tourBusiness+=b;
tourCollection+=c;

let balance=cleanNumber(row[BALANCE]);
areaBalance+=balance;

todayPartyArr.push({
name:row[PARTY],
balance
});

let credit=cleanNumber(row[CREDIT]);

if(credit>45){
creditArr.push({
name:row[PARTY],
credit
});
}

}

});

document.getElementById("quickStats").innerHTML=
`Total Shops: ${totalShops}<br>
Active: ${active} | Inactive: ${inactive}<br>
MTD Business: ‚Çπ${Math.round(totalBusiness).toLocaleString()}<br>
MTD Collection: ‚Çπ${Math.round(totalCollection).toLocaleString()}`;

let target=tourBusiness*0.30;
let achievement=target?(tourCollection/target*100):0;

document.getElementById("tourStats").innerHTML=
`Total Shops: ${tourShops}<br>
Active: ${tourActive} | Inactive: ${tourInactive}<br>
MTD Business: ‚Çπ${Math.round(tourBusiness).toLocaleString()}<br>
MTD Collection: ‚Çπ${Math.round(tourCollection).toLocaleString()}<br>
Target: ‚Çπ${Math.round(target).toLocaleString()}<br>
Achievement: ${achievement.toFixed(0)}%`;

document.getElementById("dailyTarget").innerText=
"‚Çπ"+Math.round(areaBalance*0.30).toLocaleString();

document.getElementById("todayCount").innerHTML=
`Total Parties: ${todayPartyArr.length}`;

document.getElementById("todayParties").innerHTML=
todayPartyArr.map(p=>
`<li onclick="showParty('${p.name.replace(/'/g,"")}')">
${p.name} ‚Äì ‚Çπ${p.balance.toLocaleString()}
</li>`).join("");

document.getElementById("creditCount").innerHTML=
`Total Parties: ${creditArr.length}`;

document.getElementById("creditExceeded").innerHTML=
creditArr.map(c=>
`<li onclick="showParty('${c.name.replace(/'/g,"")}')">
${c.name} ‚Äì ${c.credit} days
</li>`).join("");

}

});

}

function showParty(name){

const data = sheetData;
const columns = Object.keys(data[0]);
const col = n => columns.find(c => normalize(c).includes(n));

const PARTY = col("party");
const AREA = col("area");
const STATUS = col("accountstatus");
const BALANCE = col("balance");
const REACTIVATE = col("paymentneededtoreactivate");
const FY_BUSINESS = col("business");
const BUSINESS_MTD = col("businesscurrentmonth");
const COLLECTION_MTD = col("collectionscurrentmonth");
const CREDIT = col("avgcreditcycle");
const RISK = col("balanceasofbusiness");

let party = data.find(p => p[PARTY] === name);

document.getElementById("partyCard").style.display="block";

document.getElementById("partyDetails").innerHTML=`
<b>${name}</b><br><br>
Area: ${party[AREA]}<br>
Status: ${party[STATUS]}<br>
Balance: ‚Çπ${cleanNumber(party[BALANCE]).toLocaleString()}<br>
Reactivate by Paying: ‚Çπ${cleanNumber(party[REACTIVATE]).toLocaleString()}<br><br>
FY Business: ‚Çπ${cleanNumber(party[FY_BUSINESS]).toLocaleString()}<br>
MTD Business: ‚Çπ${cleanNumber(party[BUSINESS_MTD]).toLocaleString()}<br>
MTD Collection: ‚Çπ${cleanNumber(party[COLLECTION_MTD]).toLocaleString()}<br><br>
Avg Credit Cycle: ${party[CREDIT]} days<br>
Balance % of Business: ${party[RISK]}%
`;

document.getElementById("actionButtons").innerHTML=`
<button class="call" onclick="alert('Call feature')">üìû Call</button>
<button class="whatsapp" onclick="alert('WhatsApp feature')">üí¨ WhatsApp</button>
<button class="collect" onclick="alert('Collection entry')">üí∞ Collect</button>
<button class="bill" onclick="alert('Billing screen')">üßæ Bill</button>
`;

window.scrollTo({top:0,behavior:"smooth"});
}

loadData();
setInterval(loadData,300000);

</script>

</body>
</html>
