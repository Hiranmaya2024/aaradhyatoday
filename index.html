<!DOCTYPE html>
<html>
<head>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>AARADHYA TODAY</title>

<script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>

<style>
body{font-family:Arial;margin:0;background:#f3fbf9;}
.header{background:#1e8e7e;color:white;text-align:center;padding:12px;}
.container{padding:12px}
.card{background:white;padding:12px;border-radius:12px;margin-bottom:12px}
ul{padding-left:18px}
li{cursor:pointer;margin-bottom:6px}
</style>
</head>

<body>

<div class="header">
<b>AARADHYA TODAY</b>
<div id="tourArea"></div>
<button onclick="loadData()">ðŸ”„ Refresh</button>
<div id="lastUpdated"></div>
</div>

<div class="container">

<div class="card">
<b>ðŸš« Route Reactivation Summary</b>
<div id="reactivationSummary"></div>
</div>

<div class="card">
<b>ðŸ§  Smart Recovery Plan â€“ Today</b>
<div id="smartRecovery"></div>
</div>

<div class="card">
<b>ðŸ§­ Todayâ€™s Route Parties</b>
<div id="todayCount"></div>
<ul id="todayParties"></ul>
</div>

<div class="card">
<b>â± Credit Cycle > 45 Days</b>
<div id="creditCount"></div>
<ul id="creditExceeded"></ul>
</div>

<div class="card" id="partyCard" style="display:none">
<b>ðŸ‘¤ Party Details</b>
<div id="partyDetails"></div>
</div>

</div>

<script>

const sheetURL="https://docs.google.com/spreadsheets/d/e/2PACX-1vQ3bMMFf71-vdGNiWFnf7pD9XuAAUSA7J-g08ocyC2LNiVOTUHi56lB-7bKTKj0KK9nJGs9vU0THQ0E/pub?gid=1044390124&single=true&output=csv";

const tourPlan={
Monday:["JURIA"],
Tuesday:["GHESS"],
Wednesday:["GAISILATE"],
Thursday:["JHARBANDH"],
Friday:["PADAMPUR"],
Saturday:["PAIKMAL","MANDOSIL"]
};

let sheetData=[];
let COL={};

function num(v){
return Number(String(v||0).replace(/[^0-9.-]/g,""))||0;
}

function normalize(t){
return t.toLowerCase().replace(/[^a-z]/g,"");
}

function loadData(){

const today=new Date().toLocaleDateString("en-US",{weekday:"long"});
const todayAreas=tourPlan[today]||[];

document.getElementById("tourArea").innerText=
today+" Tour â†’ "+todayAreas.join(", ");

Papa.parse(sheetURL+"&t="+Date.now(),{
download:true,
header:true,
skipEmptyLines:true,

complete:function(res){

if(!res.data || !res.data.length){
alert("No data received from sheet");
return;
}

sheetData=res.data;

// SAFE COLUMN MAP
const cols=Object.keys(sheetData[0]);

const findCol = key =>
cols.find(c=>normalize(c).includes(key)) || "" ;

COL={
PARTY:findCol("party"),
AREA:findCol("area"),
STATUS:findCol("accountstatus"),
BALANCE:findCol("balance"),
REACTIVATE:findCol("reactivate"),
CREDIT:findCol("credit")
};

let blockCount=0;
let targetCount=0;
let unlockBusiness=0;

let todayList=[];
let creditList=[];

sheetData.forEach(r=>{

let area=(r[COL.AREA]||"").toUpperCase().trim();
let status=(r[COL.STATUS]||"").toUpperCase();

if(todayAreas.includes(area)){

todayList.push({
name:r[COL.PARTY],
balance:num(r[COL.BALANCE])
});

// CREDIT > 45
if(num(r[COL.CREDIT])>45){
creditList.push({
name:r[COL.PARTY],
credit:r[COL.CREDIT]
});
}

// BLOCK
if(status==="BLOCK"){
blockCount++;
targetCount+=num(r[COL.REACTIVATE]);
unlockBusiness+=num(r[COL.BALANCE]);
}

}

});

// ROUTE SUMMARY
document.getElementById("reactivationSummary").innerHTML=
`Blocked: ${blockCount}<br>
Unlock Business: â‚¹${unlockBusiness.toLocaleString()}<br>
Target: â‚¹${targetCount.toLocaleString()}`;

// SMART RECOVERY
document.getElementById("smartRecovery").innerHTML=
`Collect â‚¹${targetCount.toLocaleString()} â†’ Unlock â‚¹${unlockBusiness.toLocaleString()}`;

// TODAY LIST
document.getElementById("todayCount").innerText=
"Total Parties: "+todayList.length;

document.getElementById("todayParties").innerHTML=
todayList.map(p=>`<li onclick="showParty('${p.name}')">${p.name} â€“ â‚¹${p.balance.toLocaleString()}</li>`).join("");

// CREDIT LIST
document.getElementById("creditCount").innerText=
"Total Parties: "+creditList.length;

document.getElementById("creditExceeded").innerHTML=
creditList.map(c=>`<li onclick="showParty('${c.name}')">${c.name} â€“ ${c.credit} days</li>`).join("");

document.getElementById("lastUpdated").innerText=
"Last updated: "+new Date().toLocaleTimeString();

}

});

}

function showParty(name){

let party=sheetData.find(r=>r[COL.PARTY]===name);
if(!party)return;

document.getElementById("partyCard").style.display="block";

document.getElementById("partyDetails").innerHTML=
`<b>${name}</b><br>
Area: ${party[COL.AREA]}<br>
Status: ${party[COL.STATUS]}<br>
Balance: â‚¹${num(party[COL.BALANCE]).toLocaleString()}`;
}

loadData();
setInterval(loadData,120000);

</script>

</body>
</html>