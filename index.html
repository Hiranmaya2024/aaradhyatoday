<!DOCTYPE html>
<html>
<head>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>AARADHYA TODAY</title>

<script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>

<style>
*{box-sizing:border-box}
body{font-family:Arial;margin:0;background:#f3fbf9;}

.header{
position:sticky;top:0;z-index:1000;
background:linear-gradient(90deg,#1e8e7e,#2fa36b);
color:white;text-align:center;padding:12px;
}

.container{padding:12px;max-width:1400px;margin:auto;}
.dashboard-grid{display:grid;gap:12px;grid-template-columns:repeat(auto-fit,minmax(280px,1fr));}

.card{background:white;padding:14px;border-radius:14px;box-shadow:0 2px 8px rgba(0,0,0,0.08);}
.big{font-weight:bold;color:#1e8e7e;}

ul{padding-left:18px;margin:0;max-height:260px;overflow:auto;}
li{cursor:pointer;margin-bottom:6px;}

.blockCard{border:2px solid #dc2626;background:#fff1f2;}
.unlockBox{background:#16a34a;color:white;padding:8px;border-radius:8px;margin:8px 0;text-align:center;font-weight:bold;}
.payBox{background:#dc2626;color:white;padding:10px;border-radius:10px;margin:10px 0;text-align:center;font-weight:bold;}
</style>
</head>

<body>

<div class="header">
<b>AARADHYA TODAY</b>
<div id="tourArea"></div>
<button onclick="loadData()">ðŸ”„ Refresh</button>
<div id="lastUpdated" style="font-size:12px;"></div>
</div>

<div class="container">
<div class="dashboard-grid">

<div class="card" id="partyCard" style="display:none;">
<b>ðŸ‘¤ Party Details</b>
<div id="partyDetails"></div>
</div>

<div class="card">
<b>ðŸš« Route Reactivation Summary</b>
<div id="reactivationSummary" class="big"></div>
</div>

<div class="card">
<b>ðŸ§  Smart Recovery Plan â€“ Today</b>
<div id="smartRecovery"></div>
</div>

<div class="card">
<b>ðŸ§­ Todayâ€™s Route Parties</b>
<ul id="todayParties"></ul>
</div>

<div class="card">
<b>â± Credit Cycle > 45 Days</b>
<ul id="creditExceeded"></ul>
</div>

</div>
</div>

<script>

const sheetURL="https://docs.google.com/spreadsheets/d/e/2PACX-1vQ3bMMFf71-vdGNiWFnf7pD9XuAAUSA7J-g08ocyC2LNiVOTUHi56lB-7bKTKj0KK9nJGs9vU0THQ0E/pub?gid=1044390124&single=true&output=csv";

const tourPlan={
Monday:["JURIA"],
Tuesday:["GHESS"],
Wednesday:["GAISILATE"],
Thursday:["JHARBANDH"],
Friday:["PADAMPUR"],
Saturday:["PAIKMAL","MANDOSIL"]
};

let data=[];

function num(v){return Number(String(v||0).replace(/[^0-9.-]/g,""))||0;}

function loadData(){

const today=new Date().toLocaleDateString("en-US",{weekday:"long"});
const todayAreas=tourPlan[today]||[];

document.getElementById("tourArea").innerText=today+" Tour â†’ "+todayAreas.join(", ");

Papa.parse(sheetURL+"&t="+Date.now(),{
download:true,header:true,skipEmptyLines:true,

complete:function(res){

data=res.data;

let blockedCount=0;
let unlockBusiness=0;
let targetCount=0;

let todayList=[];
let creditList=[];

data.forEach(r=>{

let area=(r["AREA"]||"").trim().toUpperCase();
let status=(r["ACCOUNT STATUS"]||"").trim().toUpperCase();

if(todayAreas.includes(area)){

todayList.push({
name:r["PARTY"],
balance:num(r["BALANCE"])
});

// ðŸš« BLOCK LOGIC
if(status==="BLOCK"){

blockedCount++;

unlockBusiness+=num(r["BALANCE"]);      // COLUMN G
targetCount+=num(r["Payment needed to Reactivate"]); // COLUMN E

}

// â± CREDIT CYCLE > 45
if(num(r["AVG CREDIT CYCLE"])>45){
creditList.push({
name:r["PARTY"],
days:r["AVG CREDIT CYCLE"]
});
}

}

});

// ðŸš« ROUTE REACTIVATION SUMMARY
document.getElementById("reactivationSummary").innerHTML=`
Blocked Count: ${blockedCount}<br>
Unlock Business: â‚¹${unlockBusiness.toLocaleString()}<br>
Target: â‚¹${targetCount.toLocaleString()}
`;

// ðŸ§  SMART RECOVERY (uses summary values)
document.getElementById("smartRecovery").innerHTML=
`Collect â‚¹${targetCount.toLocaleString()} â†’ Unlock â‚¹${unlockBusiness.toLocaleString()}`;

// ðŸ§­ PARTY LIST
document.getElementById("todayParties").innerHTML=
todayList.map(p=>`
<li onclick="showParty('${p.name}')">
${p.name} â€“ â‚¹${p.balance.toLocaleString()}
</li>`).join("");

// â± CREDIT LIST
document.getElementById("creditExceeded").innerHTML=
creditList.map(c=>`
<li onclick="showParty('${c.name}')">
${c.name} â€“ ${c.days} days
</li>`).join("");

document.getElementById("lastUpdated").innerText="Last updated: "+new Date().toLocaleTimeString();

}

});

}

function showParty(name){

let party=data.find(r=>r["PARTY"]===name);
if(!party)return;

let status=(party["ACCOUNT STATUS"]||"").toUpperCase();
let isBlock=status==="BLOCK";

let balance=num(party["BALANCE"]);
let target=num(party["Payment needed to Reactivate"]);
let recovered=num(party["Collections Current Month"]);
let remaining=target-recovered;
if(remaining<0)remaining=0;

let unlockBusiness=num(party["BALANCE"]);

let card=document.getElementById("partyCard");
card.style.display="block";
card.classList.toggle("blockCard",isBlock);

document.getElementById("partyDetails").innerHTML=`

<b>${name}</b><br><br>

Area: ${party["AREA"]}<br>
Status: ${party["ACCOUNT STATUS"]}<br>

${isBlock?`<div class="unlockBox">ðŸ”“ Unlock Business: â‚¹${unlockBusiness.toLocaleString()}</div>`:""}
${isBlock?`<div class="payBox">ðŸ’° Pay â‚¹${remaining.toLocaleString()} to Unblock</div>`:""}

Balance: â‚¹${balance.toLocaleString()}<br>
Credit Cycle: ${party["AVG CREDIT CYCLE"]} days
`;

}

loadData();
setInterval(loadData,120000);

</script>

</body>
</html>