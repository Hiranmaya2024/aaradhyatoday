<!DOCTYPE html>
<html>
<head>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>AARADHYA TODAY</title>
<script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>

<style>

*{box-sizing:border-box}
body{font-family:Inter,Arial;margin:0;background:#eef2f7}

/* HEADER */
.header{
position:sticky;top:0;background:white;
padding:14px 10px;text-align:center;font-weight:700;
box-shadow:0 2px 10px rgba(0,0,0,0.06);z-index:1000;
}

#tourArea{font-size:13px;color:#64748b;margin-top:2px}
.kpiBar{font-size:15px;margin-top:6px;font-weight:800;color:#0f766e}

.progressBox{background:#e2e8f0;height:6px;border-radius:10px;margin:8px auto;max-width:240px}
#progressBar{height:6px;border-radius:10px}

/* LAYOUT */
.container{padding:14px;max-width:1400px;margin:auto}
.dashboard-grid{display:grid;gap:14px;grid-template-columns:repeat(auto-fit,minmax(260px,1fr))}

/* CARDS */
.card{background:white;padding:16px;border-radius:18px;box-shadow:0 8px 20px rgba(0,0,0,0.05)}
.missionCard{background:linear-gradient(135deg,#dc2626,#fb7185);color:white;text-align:center;padding:22px;border-radius:20px;font-size:20px;font-weight:800}

/* PARTY LIST */
.partyItem{
padding:14px;border-radius:14px;margin-bottom:10px;font-weight:700;
display:flex;justify-content:space-between;align-items:center;
}

.activeParty{background:#f0fdf4;border-left:6px solid #22c55e}
.blockParty{background:#fff1f2;border-left:6px solid #ef4444}
.normalParty{background:#f1f5f9;border-left:6px solid #cbd5f5}

.visitFirst{
background:#fef9c3 !important;
border-left:6px solid #eab308 !important;
}

/* BLOCK CARD */
.blockCard{border:2px solid #ef4444;background:#fff1f2}

.unlockBox{background:#16a34a;color:white;padding:12px;border-radius:12px;margin:12px 0;text-align:center;font-weight:800}
.payBox{background:#ef4444;color:white;padding:14px;border-radius:14px;margin:12px 0;text-align:center;font-weight:800}

.recoveryBarBg{background:#ffe4e6;height:10px;border-radius:10px;margin-top:8px}
.recoveryBar{height:10px;background:#ef4444;border-radius:10px}

/* BOTTOM BAR */
.bottomBar{
position:fixed;bottom:0;left:0;width:100%;
background:white;border-top:1px solid #e2e8f0;
display:none;justify-content:space-around;padding:10px 0;
}

.bottomBar button{
background:#0f766e;color:white;border:none;
padding:10px 14px;border-radius:10px;font-weight:700;
}

</style>
</head>

<body>

<div class="header">
AARADHYA TODAY
<div id="tourArea"></div>
<div class="kpiBar" id="fyKPI"></div>
<div class="progressBox"><div id="progressBar"></div></div>
<button onclick="loadData()">ğŸ”„</button>
<div id="lastUpdated" style="font-size:12px"></div>
</div>

<div class="container">
<div class="dashboard-grid">

<div class="missionCard" id="smartRecovery"></div>

<div class="card"><b>ğŸš« Route Activation</b><div id="reactivationSummary"></div></div>
<div class="card"><b>ğŸ“Š Quick Stats</b><div id="quickStats"></div></div>
<div class="card"><b>ğŸ“ Today Performance</b><div id="tourStats"></div></div>
<div class="card"><b>ğŸ¯ Today Target</b><div id="dailyTarget"></div></div>

<div class="card">
<b>ğŸ§­ Todayâ€™s Route Parties</b>
<div id="todayCount"></div>
<ul id="todayParties"></ul>
</div>

<div class="card">
<b>â± Credit Cycle > 45</b>
<div id="creditCount"></div>
<ul id="creditExceeded"></ul>
</div>

<div class="card" id="partyCard" style="display:none;">
<b>ğŸ‘¤ Party Details</b>
<div id="partyDetails"></div>
</div>

</div>
</div>

<div class="bottomBar" id="actionBar">
<button id="callBtn">ğŸ“ Call</button>
<button id="waBtn">ğŸ’¬ WhatsApp</button>
<button id="mapBtn">ğŸ“ Map</button>
</div>

<script>

const sheetURL="https://docs.google.com/spreadsheets/d/e/2PACX-1vQ3bMMFf71-vdGNiWFnf7pD9XuAAUSA7J-g08ocyC2LNiVOTUHi56lB-7bKTKj0KK9nJGs9vU0THQ0E/pub?gid=1044390124&single=true&output=csv";

let COL={},sheetData=[],priorityList=[];

function cleanNumber(v){return Number(String(v||0).replace(/[^0-9.-]/g,""))||0;}
function normalize(t){return t.toLowerCase().replace(/[^a-z]/g,"");}

function loadData(){

Papa.parse(sheetURL+"&t="+Date.now(),{
download:true,header:true,skipEmptyLines:true,

complete:function(res){

sheetData=res.data;
const columns=Object.keys(sheetData[0]);
const col=n=>columns.find(c=>normalize(c).includes(n));

COL={
PARTY:col("party"),AREA:col("area"),STATUS:col("accountstatus"),
BALANCE:col("balance"),COLLECTION_MTD:col("collectionscurrentmonth"),
REACTIVATE:col("paymentneededtoreactivate"),
PHONE:col("phone")
};

let smartList=[],todayList=[];

sheetData.forEach(r=>{
let target=cleanNumber(r[COL.REACTIVATE]);
let recovered=cleanNumber(r[COL.COLLECTION_MTD]);
let remaining=target-recovered;

if(remaining>0) smartList.push({name:r[COL.PARTY],remaining});
todayList.push(r);
});

smartList.sort((a,b)=>a.remaining-b.remaining);
priorityList=smartList.slice(0,3).map(x=>x.name);

document.getElementById("todayParties").innerHTML=
todayList.map(r=>{

let status=(r[COL.STATUS]||"").toUpperCase();
let cls=status==="ACTIVE"?"activeParty":
status==="BLOCK"?"blockParty":"normalParty";

if(priorityList.includes(r[COL.PARTY])) cls+=" visitFirst";

return `<li class="partyItem ${cls}" onclick="showParty('${r[COL.PARTY]}')">
${r[COL.PARTY]}
</li>`;

}).join("");

}

});
}

function showParty(name){

let party=sheetData.find(r=>r[COL.PARTY]===name);
let phone=party[COL.PHONE];

document.getElementById("actionBar").style.display="flex";

document.getElementById("callBtn").onclick=()=>location.href=`tel:${phone}`;
document.getElementById("waBtn").onclick=()=>location.href=`https://wa.me/91${phone}`;
document.getElementById("mapBtn").onclick=()=>window.open(`https://www.google.com/maps/search/${name}`);

}

loadData();
setInterval(loadData,120000);

</script>
</body>
</html>