<!DOCTYPE html>
<html>
<head>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>AARADHYA TODAY</title>
<script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>

<style>
body{font-family:Arial;margin:0;background:#f1f5f9}
.header{background:#fff;padding:10px;border-bottom:1px solid #ddd;text-align:center}
.main{display:flex;height:calc(100vh - 170px)}
.left{width:40%;overflow:auto;background:#fff}
.right{width:60%;padding:10px;overflow:auto}
.card{background:#fff;padding:10px;border-radius:10px;border:1px solid #e2e8f0;margin-bottom:10px}
.party{padding:10px;border-bottom:1px solid #eee;cursor:pointer}
.block{border-left:4px solid red}
.active{border-left:4px solid green}
.btn{padding:6px 10px;border-radius:8px;color:#fff;text-decoration:none;margin:5px 5px 0 0;display:inline-block}
.call{background:#16a34a}.wa{background:#25D366}.nav{background:#2563eb}.start{background:#0f766e}
</style>
</head>

<body>

<div class="header">
<select id="daySelect"></select>
<div id="dayArea"></div>
</div>

<div class="main">

<div class="left">
<div class="card" id="summary"></div>
<div id="partyList"></div>
</div>

<div class="right">

<div class="card" id="aiBox"></div>

<div class="card" id="partyCard">Select a party</div>

<div class="card">
<b>Today Credit Risk</b>
<div id="creditList"></div>
</div>

</div>

</div>

<script>

const url="https://docs.google.com/spreadsheets/d/e/2PACX-1vQ3bMMFf71-vdGNiWFnf7pD9XuAAUSA7J-g08ocyC2LNiVOTUHi56lB-7bKTKj0KK9nJGs9vU0THQ0E/pub?gid=1044390124&single=true&output=csv";

const tourPlan={
Monday:["JURIA"],
Tuesday:["GHESS"],
Wednesday:["GAISILATE"],
Thursday:["JHARBANDH"],
Friday:["PADAMPUR"],
Saturday:["PAIKMAL","MANDOSIL"]
};

let rawData=[],todayData=[];

function num(v){return Number(String(v||0).replace(/[^0-9.-]/g,""))||0;}

function normalizeRow(r){

return{
party:r["PARTY"],
area:(r["AREA"]||"").toUpperCase(),
status:(r["ACCOUNT STATUS"]||"").toUpperCase(),
balance:num(r["BALANCE"]),
creditDays:num(r["AVG CREDIT CYCLE"] || r["AVG CREDIT CYCLE "] || r["Avg Credit Cycle"]),
phone:r["PHONE"],
lat:r["LAT"],
lng:r["LNG"],
reactivate:num(r["Payment needed to Reactivate"])
};

}

function loadData(){

Papa.parse(url,{
download:true,
header:true,
skipEmptyLines:true,

complete:function(res){

rawData=res.data.map(normalizeRow);

init();

}

});
}

function getTodayDay(){

let d=new Date().toLocaleDateString("en-US",{weekday:"long"});
return tourPlan[d]?d:"Monday";

}

function init(){

Object.keys(tourPlan).forEach(d=>daySelect.innerHTML+=`<option>${d}</option>`);

daySelect.value=getTodayDay();
daySelect.onchange=render;

render();

}

function render(){

let day=daySelect.value;
let areas=tourPlan[day];

document.getElementById("dayArea").innerHTML="<b>"+day+" â†’ "+areas.join(", ")+"</b>";

todayData=rawData.filter(r=>areas.includes(r.area));

renderSummary();
renderPartyList();
renderCreditList();
renderAI();

}

function renderSummary(){

let total=0;
todayData.forEach(r=>total+=r.reactivate);

document.getElementById("summary").innerHTML=
"ðŸ“Š Recoverable Today â‚¹"+total.toLocaleString();

}

function renderPartyList(){

document.getElementById("partyList").innerHTML=
todayData.map(p=>`
<div class="party ${p.status==="BLOCK"?"block":"active"}"
onclick="showParty('${p.party}')">
${p.party}<br>â‚¹${p.balance.toLocaleString()}
</div>`).join("");

}

function renderCreditList(){

let list=[...todayData].sort((a,b)=>b.creditDays-a.creditDays);

document.getElementById("creditList").innerHTML=
list.map(p=>`${p.party} â€“ ${p.creditDays} days`).join("<br>");

}

function renderAI(){

let priority=[...todayData]
.sort((a,b)=>(b.creditDays+b.balance)-(a.creditDays+a.balance))[0];

document.getElementById("aiBox").innerHTML=
`ðŸ”¥ Priority Recovery: <b>${priority?.party||"-"}</b>`;

}

function showParty(name){

let p=todayData.find(x=>x.party===name);

document.getElementById("partyCard").innerHTML=`
<b>${p.party}</b><br>${p.area}<br>
Balance â‚¹${p.balance.toLocaleString()}<br>
Credit ${p.creditDays} days<br><br>

<a class="btn call" href="tel:${p.phone}">Call</a>
<a class="btn wa" href="https://wa.me/91${p.phone}">WhatsApp</a>
<a class="btn nav" href="https://www.google.com/maps?q=${p.lat},${p.lng}" target="_blank">Navigate</a>
`;

}

loadData();

</script>
</body>
</html>