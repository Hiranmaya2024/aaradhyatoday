<!DOCTYPE html>
<html>
<head>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>AARADHYA TODAY</title>

<script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>

<style>
body{font-family:Arial;margin:0;background:#f1f5f9}

.header{background:#fff;padding:10px;border-bottom:1px solid #ddd;text-align:center;position:sticky;top:0}

.card{background:#fff;margin:8px;padding:12px;border-radius:12px;border:1px solid #e2e8f0}

.party{padding:10px;border-bottom:1px solid #eee;display:flex;justify-content:space-between;cursor:pointer}

.active{border-left:5px solid #22c55e}
.block{border-left:5px solid #ef4444;background:#fff1f2}

.btn{
display:inline-block;
padding:6px 10px;
border-radius:8px;
margin:6px 4px 0 0;
color:#fff;
text-decoration:none;
font-size:13px
}

.call{background:#16a34a}
.wa{background:#25D366}
.nav{background:#2563eb}

.switch button{
padding:6px 10px;
margin:4px;
border:none;
border-radius:8px;
cursor:pointer
}
.activeTab{background:#0f766e;color:#fff}
</style>
</head>

<body>

<div class="header">

<select id="daySelect"></select>

<div class="switch">
<button id="planBtn" class="activeTab">Visit Plan</button>
<button id="routeBtn">Today Route</button>
</div>

<div id="kpi"></div>

</div>

<div class="card" id="listContainer"></div>

<div class="card" id="partyCard" style="display:none"></div>

<div class="card">
<b>â± Credit Cycle > 45 Days</b>
<div id="creditList"></div>
</div>

<script>

const tourPlan={
Monday:["JURIA"],
Tuesday:["GHESS"],
Wednesday:["GAISILATE"],
Thursday:["JHARBANDH"],
Friday:["PADAMPUR"],
Saturday:["PAIKMAL","MANDOSIL"]
};

const daySelect=document.getElementById("daySelect");

Object.keys(tourPlan).forEach(d=>daySelect.innerHTML+=`<option>${d}</option>`);

daySelect.value=new Date().toLocaleDateString("en-US",{weekday:"long"});

let sheetData=[];
let viewMode="plan";

const url="YOUR CSV LINK";

function num(v){return Number(String(v||0).replace(/[^0-9.-]/g,""))||0;}

function loadData(){

Papa.parse(url,{download:true,header:true,skipEmptyLines:true,complete:function(res){
sheetData=res.data;
render();
}});

}

function getDayData(){

return sheetData.filter(r=>
tourPlan[daySelect.value].includes((r["AREA"]||"").toUpperCase())
);

}

function render(){

let data=getDayData();

renderList(data);
renderCreditList(data);

}

function renderList(data){

let list=[...data];

if(viewMode=="plan"){

list.sort((a,b)=>{

let aBlock=(a["ACCOUNT STATUS"]||"").toUpperCase()=="BLOCK";
let bBlock=(b["ACCOUNT STATUS"]||"").toUpperCase()=="BLOCK";

if(aBlock&&!bBlock) return -1;
if(!aBlock&&bBlock) return 1;

return num(b["BALANCE"]) - num(a["BALANCE"]);
});

}

document.getElementById("listContainer").innerHTML=

list.map(p=>`
<div class="party ${(p["ACCOUNT STATUS"]||"").toUpperCase()=="BLOCK"?"block":"active"}"
onclick="showParty('${p["PARTY"]}')">

${p["PARTY"]}
<span>â‚¹${num(p["BALANCE"]).toLocaleString()}</span>

</div>
`).join("");

}

function showParty(name){

let p=sheetData.find(x=>x["PARTY"]===name);

let phone=p["PHONE"];

let pay=num(p["Payment needed to Reactivate"]);
let rec=num(p["Collections Current Month"]);

document.getElementById("partyCard").style.display="block";

document.getElementById("partyCard").innerHTML=`

<b>${p["PARTY"]}</b><br>
${p["AREA"]}<br><br>

Balance â‚¹${num(p["BALANCE"]).toLocaleString()}<br>
Credit Days ${p["AVG CREDIT CYCLE"]}<br>
MTD Business â‚¹${num(p["BUSINESS CURRENT MONTH"]).toLocaleString()}<br>
MTD Collection â‚¹${rec.toLocaleString()}

${pay?`
<br><br>ðŸ”“ Unlock â‚¹${num(p["BALANCE"]).toLocaleString()}
<br>ðŸ’° Pay â‚¹${pay.toLocaleString()}
`:""}

<br><br>

<a class="btn call" href="tel:${phone}">â˜Ž Call</a>
<a class="btn wa" href="https://wa.me/91${phone}" target="_blank">ðŸ’¬ WhatsApp</a>

`;

}

function renderCreditList(data){

let list=data
.filter(r=>num(r["AVG CREDIT CYCLE"])>45)
.sort((a,b)=>num(b["AVG CREDIT CYCLE"])-num(a["AVG CREDIT CYCLE"]));

document.getElementById("creditList").innerHTML=
list.map(p=>`
<div class="party block" onclick="showParty('${p["PARTY"]}')">

${p["PARTY"]} â€“ ${p["AVG CREDIT CYCLE"]} days
<span>â‚¹${num(p["BALANCE"]).toLocaleString()}</span>

</div>
`).join("");

}

planBtn.onclick=()=>{viewMode="plan";planBtn.classList.add("activeTab");routeBtn.classList.remove("activeTab");render();}
routeBtn.onclick=()=>{viewMode="route";routeBtn.classList.add("activeTab");planBtn.classList.remove("activeTab");render();}

daySelect.onchange=render;

loadData();

</script>

</body>
</html>