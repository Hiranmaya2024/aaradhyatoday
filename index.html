<!DOCTYPE html>
<html>
<head>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>AARADHYA TODAY</title>

<link rel="manifest" href="manifest.json">

<script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>

<style>
body{font-family:Arial;margin:0;background:#f3fbf9;}

.header{
background:linear-gradient(90deg,#1e8e7e,#2fa36b);
color:white;
text-align:center;
padding:14px;
}

.topStats{margin-top:8px;font-size:13px;}

.progressBox{
background:#ffffff40;
border-radius:10px;
height:8px;
margin:6px 20px;
}

#progressBar{
height:8px;
width:0%;
border-radius:10px;
background:red;
}

.container{padding:12px;}

.card{
background:white;
padding:14px;
margin-bottom:12px;
border-radius:12px;
box-shadow:0 2px 6px rgba(0,0,0,0.1);
}

.big{
font-size:17px;
font-weight:bold;
color:#1e8e7e;
line-height:1.6;
}

ul{padding-left:18px;margin:0;}
li{cursor:pointer;margin-bottom:6px;}

button{
padding:10px;
border:none;
border-radius:8px;
margin:5px 5px 0 0;
font-weight:bold;
}

.call{background:#2563eb;color:white;}
.whatsapp{background:#16a34a;color:white;}
.collect{background:#f59e0b;color:white;}
.bill{background:#7c3aed;color:white;}

.redText{color:red;font-weight:bold;}
</style>
</head>

<body>

<div class="header">
<b>AARADHYA TODAY</b>

<div id="tourArea"></div>

<div class="topStats">
<div id="totalBusiness"></div>
<div id="totalCollection"></div>

<div class="progressBox">
<div id="progressBar"></div>
</div>

<div id="businessStatus"></div>
</div>
</div>

<div class="container">

<div class="card" id="partyCard" style="display:none;border:2px solid #1e8e7e;">
<b>üë§ Party Details</b>
<div id="partyDetails" class="big"></div>
<div id="actionButtons"></div>
</div>

<div class="card">
<b>üìä Quick Stats ‚Äì All Areas (MTD)</b>
<div id="quickStats" class="big"></div>
</div>

<div class="card">
<b>üìç Today‚Äôs Tour Performance (MTD)</b>
<div id="tourStats" class="big"></div>
</div>

<div class="card">
<b>üéØ Today‚Äôs Collection Target</b>
<div id="dailyTarget" class="big"></div>
</div>

<div class="card">
<b>üß≠ Today‚Äôs Route Parties</b>
<div id="todayCount" class="big"></div>
<ul id="todayParties"></ul>
</div>

<div class="card">
<b>‚è± Credit Cycle > 45 Days</b>
<div id="creditCount" class="big"></div>
<ul id="creditExceeded"></ul>
</div>

</div>

<script>

const sheetURL = "https://docs.google.com/spreadsheets/d/e/2PACX-1vQ3bMMFf71-vdGNiWFnf7pD9XuAAUSA7J-g08ocyC2LNiVOTUHi56lB-7bKTKj0KK9nJGs9vU0THQ0E/pub?gid=1044390124&single=true&output=csv";

const tourPlan = {
Monday:["Juria"],
Tuesday:["Ghess"],
Wednesday:["Gaisilate"],
Thursday:["Jharbandh"],
Friday:["Padampur"],
Saturday:["Paikmal","Mandosil"]
};

function cleanNumber(val){
return Number(String(val||0).replace(/[^0-9.-]/g,""))||0;
}

function normalize(text){
return text.toLowerCase().replace(/[^a-z]/g,"");
}

function loadData(){

const today = new Date().toLocaleDateString("en-US",{weekday:"long"});
const todayAreas = tourPlan[today]||[];

document.getElementById("tourArea").innerText =
today+" Tour ‚Üí "+todayAreas.join(", ");

Papa.parse(sheetURL,{
download:true,
header:true,
skipEmptyLines:true,

complete:function(res){

window.sheetData = res.data;
const data = sheetData;

const columns = Object.keys(data[0]);
const col = name => columns.find(c => normalize(c).includes(name));

const AREA = col("area");
const PARTY = col("party");
const STATUS = col("accountstatus");
const BALANCE = col("balance");
const BUSINESS = col("business");
const BUSINESS_MTD = col("businesscurrentmonth");
const COLLECTION_MTD = col("collectionscurrentmonth");
const REACTIVATE = col("paymentneededtoreactivate");
const CREDIT = col("avgcreditcycle");
const RISK = col("balanceasofbusiness");

let fyBusinessTotal=0, fyBalanceTotal=0;

let totalShops=data.length, active=0,inactive=0;
let totalBusiness=0,totalCollection=0;

let tourShops=0,tourActive=0,tourInactive=0;
let tourBusiness=0,tourCollection=0;
let areaBalance=0;

let todayPartyArr=[];
let creditArr=[];

data.forEach(row=>{

let status=(row[STATUS]||"").toUpperCase();

if(status==="ACTIVE") active++; else inactive++;

fyBusinessTotal+=cleanNumber(row[BUSINESS]);
fyBalanceTotal+=cleanNumber(row[BALANCE]);

let b=cleanNumber(row[BUSINESS_MTD]);
let c=cleanNumber(row[COLLECTION_MTD]);

totalBusiness+=b;
totalCollection+=c;

if(todayAreas.includes(row[AREA])){

tourShops++;

if(status==="ACTIVE") tourActive++; else tourInactive++;

tourBusiness+=b;
tourCollection+=c;

let balance=cleanNumber(row[BALANCE]);
areaBalance+=balance;

todayPartyArr.push({name:row[PARTY],balance});

let credit=cleanNumber(row[CREDIT]);
if(credit>45) creditArr.push({name:row[PARTY],credit});

}

});

let totalCollectionFY = fyBusinessTotal - fyBalanceTotal;
let statusPercent = fyBusinessTotal ? (totalCollectionFY / fyBusinessTotal)*100 : 0;

document.getElementById("totalBusiness").innerHTML =
`üíº Business: ‚Çπ${Math.round(fyBusinessTotal).toLocaleString()}`;

document.getElementById("totalCollection").innerHTML =
`üí∞ Collection: ‚Çπ${Math.round(totalCollectionFY).toLocaleString()}`;

document.getElementById("businessStatus").innerHTML =
`Status: ${statusPercent.toFixed(0)}%`;

let bar = document.getElementById("progressBar");
bar.style.width = statusPercent+"%";

if(statusPercent<40) bar.style.background="red";
else if(statusPercent<70) bar.style.background="orange";
else bar.style.background="limegreen";

document.getElementById("quickStats").innerHTML=
`Total Shops: ${totalShops}<br>
Active: ${active} | Inactive: ${inactive}<br>
MTD Business: ‚Çπ${Math.round(totalBusiness).toLocaleString()}<br>
MTD Collection: ‚Çπ${Math.round(totalCollection).toLocaleString()}`;

let target=tourBusiness*0.30;
let achievement=target?(tourCollection/target*100):0;

document.getElementById("tourStats").innerHTML=
`Total Shops: ${tourShops}<br>
Active: ${tourActive} | Inactive: ${tourInactive}<br>
MTD Business: ‚Çπ${Math.round(tourBusiness).toLocaleString()}<br>
MTD Collection: ‚Çπ${Math.round(tourCollection).toLocaleString()}<br>
Target: ‚Çπ${Math.round(target).toLocaleString()}<br>
Achievement: ${achievement.toFixed(0)}%`;

document.getElementById("dailyTarget").innerText=
"‚Çπ"+Math.round(areaBalance*0.30).toLocaleString();

document.getElementById("todayCount").innerHTML=
`Total Parties: ${todayPartyArr.length}`;

document.getElementById("todayParties").innerHTML=
todayPartyArr.map(p=>
`<li onclick="showParty('${p.name.replace(/'/g,"")}')">
${p.name} ‚Äì ‚Çπ${p.balance.toLocaleString()}
</li>`).join("");

document.getElementById("creditCount").innerHTML=
`Total Parties: ${creditArr.length}`;

document.getElementById("creditExceeded").innerHTML=
creditArr.map(c=>
`<li onclick="showParty('${c.name.replace(/'/g,"")}')">
${c.name} ‚Äì ${c.credit} days
</li>`).join("");

}
});
}

function showParty(name){

const data=sheetData;
const columns=Object.keys(data[0]);
const col=n=>columns.find(c=>normalize(c).includes(n));

const PARTY=col("party");
const AREA=col("area");
const STATUS=col("accountstatus");
const BALANCE=col("balance");
const REACTIVATE=col("paymentneededtoreactivate");
const FY_BUSINESS=col("business");
const BUSINESS_MTD=col("businesscurrentmonth");
const COLLECTION_MTD=col("collectionscurrentmonth");
const CREDIT=col("avgcreditcycle");
const RISK=col("balanceasofbusiness");

let party=data.find(p=>p[PARTY]===name);

document.getElementById("partyCard").style.display="block";

if(party[STATUS]==="BLOCK"){
partyCard.style.border="2px solid red";
}else{
partyCard.style.border="2px solid #1e8e7e";
}

document.getElementById("partyDetails").innerHTML=`
<b>${name}</b><br><br>
Area: ${party[AREA]}<br>
Status: <span class="${party[STATUS]==='BLOCK'?'redText':''}">${party[STATUS]}</span><br>
Balance: ‚Çπ${cleanNumber(party[BALANCE]).toLocaleString()}<br>
Reactivate by Paying: ‚Çπ${cleanNumber(party[REACTIVATE]).toLocaleString()}<br><br>
FY Business: ‚Çπ${cleanNumber(party[FY_BUSINESS]).toLocaleString()}<br>
MTD Business: ‚Çπ${cleanNumber(party[BUSINESS_MTD]).toLocaleString()}<br>
MTD Collection: ‚Çπ${cleanNumber(party[COLLECTION_MTD]).toLocaleString()}<br><br>
Avg Credit Cycle: ${party[CREDIT]} days<br>
Balance % of Business: ${party[RISK]}%
`;

document.getElementById("actionButtons").innerHTML=`
<button class="call">üìû Call</button>
<button class="whatsapp">üí¨ WhatsApp</button>
<button class="collect">üí∞ Collect</button>
<button class="bill">üßæ Bill</button>
`;

window.scrollTo({top:0,behavior:"smooth"});
}

loadData();
setInterval(loadData,300000);

</script>

</body>
</html>