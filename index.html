


<!DOCTYPE html>
<html>
<head>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>AARADHYA TODAY</title>

<link rel="manifest" href="manifest.json">
<script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>

<style>

*{box-sizing:border-box}
body{font-family:Arial;margin:0;background:#f3fbf9;}

.header{
position:sticky;top:0;z-index:1000;
background:linear-gradient(90deg,#1e8e7e,#2fa36b);
color:white;text-align:center;padding:12px;
}

.progressBox{background:#ffffff40;border-radius:10px;height:8px;margin:6px auto;max-width:500px;}
#progressBar{height:8px;width:0%;border-radius:10px;background:red;}

.container{padding:12px;max-width:1400px;margin:auto;}

.dashboard-grid{
display:grid;gap:12px;
grid-template-columns:repeat(auto-fit,minmax(280px,1fr));
}

.card{background:white;padding:14px;border-radius:14px;box-shadow:0 2px 8px rgba(0,0,0,0.08);}
.big{font-size:16px;font-weight:bold;color:#1e8e7e;line-height:1.6;}

ul{padding-left:18px;margin:0;max-height:260px;overflow:auto;}
li{cursor:pointer;margin-bottom:6px;}

button{padding:12px;border:none;border-radius:10px;font-weight:bold;min-width:110px;}
.action-grid{display:flex;flex-wrap:wrap;gap:8px;margin-top:10px;}

.call{background:#2563eb;color:white;}
.whatsapp{background:#16a34a;color:white;}
.collect{background:#f59e0b;color:white;}
.bill{background:#7c3aed;color:white;}

.redText{color:red;font-weight:bold;}

.summaryGrid{display:grid;grid-template-columns:repeat(2,1fr);gap:8px;margin-top:8px;}
.summaryBox{background:#fff1f2;padding:8px;border-radius:8px;font-weight:bold;}

.reactivationBox{background:#fff;border:2px solid #dc2626;padding:12px;border-radius:12px;margin:12px 0;}
.reactivationBarBg{background:#ffe4e6;height:10px;border-radius:10px;margin-top:6px;}
.reactivationBar{height:10px;border-radius:10px;background:#dc2626;}

</style>
</head>

<body>

<div class="header">
<b>AARADHYA TODAY</b>
<div id="tourArea"></div>
<div id="totalBusiness"></div>
<div id="totalCollection"></div>
<div class="progressBox"><div id="progressBar"></div></div>
<div id="businessStatus"></div>
</div>

<div class="container">
<div class="dashboard-grid">

<div class="card" id="partyCard" style="display:none;border:2px solid #1e8e7e;">
<b>üë§ Party Details</b>
<div id="partyDetails" class="big"></div>
<div id="actionButtons" class="action-grid"></div>
</div>

<div class="card">
<b>üö´ Route Reactivation Summary</b>
<div id="reactivationSummary" class="big"></div>
</div>

<div class="card">
<b>üìä Quick Stats ‚Äì All Areas (MTD)</b>
<div id="quickStats" class="big"></div>
</div>

<div class="card">
<b>üìç Today‚Äôs Tour Performance (MTD)</b>
<div id="tourStats" class="big"></div>
</div>

<div class="card">
<b>üéØ Today‚Äôs Collection Target</b>
<div id="dailyTarget" class="big"></div>
</div>

<div class="card">
<b>üß≠ Today‚Äôs Route Parties</b>
<div id="todayCount" class="big"></div>
<ul id="todayParties"></ul>
</div>

<div class="card">
<b>‚è± Credit Cycle > 45 Days</b>
<div id="creditCount" class="big"></div>
<ul id="creditExceeded"></ul>
</div>

</div>
</div>

<script>

const sheetURL="https://docs.google.com/spreadsheets/d/e/2PACX-1vQ3bMMFf71-vdGNiWFnf7pD9XuAAUSA7J-g08ocyC2LNiVOTUHi56lB-7bKTKj0KK9nJGs9vU0THQ0E/pub?gid=1044390124&single=true&output=csv";
const GOOGLE_FORM="PASTE_YOUR_PREFILL_FORM_LINK";
const BILLING_URL="PASTE_YOUR_BILLING_APP_LINK";

let COL = {};
let sheetData = [];

const tourPlan={
Monday:["Juria"],Tuesday:["Ghess"],Wednesday:["Gaisilate"],
Thursday:["Jharbandh"],Friday:["Padampur"],Saturday:["Paikmal","Mandosil"]
};

function cleanNumber(val){return Number(String(val||0).replace(/[^0-9.-]/g,""))||0;}
function normalize(text){return text.toLowerCase().replace(/[^a-z]/g,"");}

function loadData(){

const today=new Date().toLocaleDateString("en-US",{weekday:"long"});
const todayAreas=tourPlan[today]||[];

document.getElementById("tourArea").innerText=
today+" Tour ‚Üí "+todayAreas.join(", ");

Papa.parse(sheetURL,{download:true,header:true,skipEmptyLines:true,

complete:function(res){

sheetData=res.data;

const columns=Object.keys(sheetData[0]);
const col=n=>columns.find(c=>normalize(c).includes(n));

COL={
PARTY:col("party"),
AREA:col("area"),
STATUS:col("accountstatus"),
BUSINESS:col("business"),
BALANCE:col("balance"),
BUSINESS_MTD:col("businesscurrentmonth"),
COLLECTION_MTD:col("collectionscurrentmonth"),
CREDIT:col("avgcreditcycle"),
REACTIVATE:col("paymentneededtoreactivate")
};

let fyBusiness=0,fyBalance=0,mtdBusiness=0,mtdCollection=0;
let active=0,inactive=0;

let tourShops=0,tourActive=0,tourInactive=0;
let tourBusiness=0,tourCollection=0,tourBalance=0;

let blockCount=0,totalReactivate=0,totalRecovered=0,unlockBusiness=0;

let todayPartyArr=[],creditArr=[];

sheetData.forEach(row=>{

let status=(row[COL.STATUS]||"").toUpperCase();

fyBusiness+=cleanNumber(row[COL.BUSINESS]);
fyBalance+=cleanNumber(row[COL.BALANCE]);
mtdBusiness+=cleanNumber(row[COL.BUSINESS_MTD]);
mtdCollection+=cleanNumber(row[COL.COLLECTION_MTD]);

if(status==="ACTIVE") active++; else inactive++;

if(todayAreas.includes(row[COL.AREA])){

tourShops++;
if(status==="ACTIVE") tourActive++; else tourInactive++;

tourBusiness+=cleanNumber(row[COL.BUSINESS_MTD]);
tourCollection+=cleanNumber(row[COL.COLLECTION_MTD]);
tourBalance+=cleanNumber(row[COL.BALANCE]);

todayPartyArr.push({name:row[COL.PARTY],balance:cleanNumber(row[COL.BALANCE])});

if(cleanNumber(row[COL.CREDIT])>45){
creditArr.push({name:row[COL.PARTY],credit:row[COL.CREDIT]});
}

if(status==="BLOCK"){
blockCount++;
let reactAmt=cleanNumber(row[COL.REACTIVATE]);
let recAmt=cleanNumber(row[COL.COLLECTION_MTD]);

totalReactivate+=reactAmt;
totalRecovered+=recAmt;
unlockBusiness+=cleanNumber(row[COL.BUSINESS]);
}

}

});

// HEADER
let totalCollectionFY=fyBusiness-fyBalance;
let percent=fyBusiness?(totalCollectionFY/fyBusiness)*100:0;

document.getElementById("totalBusiness").innerHTML=`üíº Business: ‚Çπ${Math.round(fyBusiness).toLocaleString()}`;
document.getElementById("totalCollection").innerHTML=`üí∞ Collection: ‚Çπ${Math.round(totalCollectionFY).toLocaleString()}`;
document.getElementById("businessStatus").innerHTML=`Status: ${percent.toFixed(0)}%`;

let bar=document.getElementById("progressBar");
bar.style.width=percent+"%";
bar.style.background=percent<40?"red":percent<70?"orange":"limegreen";

// QUICK STATS
document.getElementById("quickStats").innerHTML=
`Total Shops: ${sheetData.length}<br>
Active: ${active} | Inactive: ${inactive}<br>
MTD Business: ‚Çπ${Math.round(mtdBusiness).toLocaleString()}<br>
MTD Collection: ‚Çπ${Math.round(mtdCollection).toLocaleString()}`;

// TOUR
let target=tourBalance*0.30;
let achievement=target?(tourCollection/target*100):0;

document.getElementById("tourStats").innerHTML=
`Total Shops: ${tourShops}<br>
Active: ${tourActive} | Inactive: ${tourInactive}<br>
MTD Business: ‚Çπ${Math.round(tourBusiness).toLocaleString()}<br>
MTD Collection: ‚Çπ${Math.round(tourCollection).toLocaleString()}<br>
Target: ‚Çπ${Math.round(target).toLocaleString()}<br>
Achievement: ${achievement.toFixed(0)}%`;

document.getElementById("dailyTarget").innerText="‚Çπ"+Math.round(target).toLocaleString();

// REACTIVATION SUMMARY
let remainingReactivate=totalReactivate-totalRecovered;
if(remainingReactivate<0)remainingReactivate=0;

document.getElementById("reactivationSummary").innerHTML=`
<div class="summaryGrid">
<div class="summaryBox">Blocked: ${blockCount}</div>
<div class="summaryBox">Unlock Business: ‚Çπ${Math.round(unlockBusiness).toLocaleString()}</div>
<div class="summaryBox">Target: ‚Çπ${Math.round(totalReactivate).toLocaleString()}</div>
<div class="summaryBox">Recovered: ‚Çπ${Math.round(totalRecovered).toLocaleString()}</div>
<div class="summaryBox" style="grid-column:1/3;background:#dc2626;color:white;">
Remaining: ‚Çπ${Math.round(remainingReactivate).toLocaleString()}
</div>
</div>`;

// LISTS
document.getElementById("todayCount").innerHTML=`Total Parties: ${todayPartyArr.length}`;

document.getElementById("todayParties").innerHTML=
todayPartyArr.map(p=>`
<li data-name="${p.name}" onclick="showParty(this.dataset.name)">
${p.name} ‚Äì ‚Çπ${p.balance.toLocaleString()}
</li>`).join("");

document.getElementById("creditCount").innerHTML=`Total Parties: ${creditArr.length}`;

document.getElementById("creditExceeded").innerHTML=
creditArr.map(c=>`
<li data-name="${c.name}" onclick="showParty(this.dataset.name)">
${c.name} ‚Äì ${c.credit} days
</li>`).join("");

}});

}

function showParty(name){

const party = sheetData.find(row => row[COL.PARTY] == name);
if(!party) return;

let phone = party[Object.keys(party)[13]] || "";
let cleanPhone = phone.toString().replace(/[^0-9]/g,"");

let callLink = `tel:+91${cleanPhone}`;

let waMsg =
`Dear ${name},
Kind reminder that your outstanding balance is ‚Çπ${cleanNumber(party[COL.BALANCE]).toLocaleString()}.
‚Äì Aaradhya Pharmaceuticals`;

let waLink =
`https://wa.me/91${cleanPhone}?text=${encodeURIComponent(waMsg)}`;

const isBlock=(party[COL.STATUS]||"").toUpperCase()==="BLOCK";

const card=document.getElementById("partyCard");
card.style.display="block";

card.style.border=isBlock?"2px solid #dc2626":"2px solid #1e8e7e";
card.style.background=isBlock?"#fff1f2":"white";

let reactivateBox="";
let progress=0;

if(isBlock){

let target=cleanNumber(party[COL.REACTIVATE]);
let recovered=cleanNumber(party[COL.COLLECTION_MTD]);

progress=target?(recovered/target)*100:0;
let remaining=target-recovered;
if(remaining<0)remaining=0;

reactivateBox=`
<div class="reactivationBox">
<b style="color:#dc2626;">üö´ BLOCKED ‚Äì REACTIVATION TRACKER</b><br><br>
Target: ‚Çπ${target.toLocaleString()}<br>
Recovered: ‚Çπ${recovered.toLocaleString()}<br>
Remaining: ‚Çπ${remaining.toLocaleString()}<br>

<div class="reactivationBarBg">
<div class="reactivationBar" style="width:${progress}%"></div>
</div>

<div style="margin-top:6px;font-weight:bold;color:#dc2626;">
${progress.toFixed(0)}% completed
</div>
</div>`;
}

document.getElementById("partyDetails").innerHTML=`
<b style="font-size:18px">${name}</b><br><br>
Area: ${party[COL.AREA]}<br>
Status: <span class="${isBlock?"redText":""}">${party[COL.STATUS]}</span><br>
Balance: ‚Çπ${cleanNumber(party[COL.BALANCE]).toLocaleString()}<br>
${reactivateBox}
FY Business: ‚Çπ${cleanNumber(party[COL.BUSINESS]).toLocaleString()}<br>
MTD Business: ‚Çπ${cleanNumber(party[COL.BUSINESS_MTD]).toLocaleString()}<br>
MTD Collection: ‚Çπ${cleanNumber(party[COL.COLLECTION_MTD]).toLocaleString()}
`;

let billButton=`<a href="${BILLING_URL}" target="_blank"><button class="bill">üßæ Bill</button></a>`;
if(isBlock && progress<100) billButton="";

document.getElementById("actionButtons").innerHTML=`
<a href="${callLink}"><button class="call">üìû Call</button></a>
<a href="${waLink}" target="_blank"><button class="whatsapp">üí¨ WhatsApp</button></a>
<a href="${GOOGLE_FORM}" target="_blank"><button class="collect">üí∞ Collect</button></a>
${billButton}
`;

window.scrollTo({top:0,behavior:"smooth"});
}

loadData();
setInterval(loadData,300000);

</script>

</body>
</html>
